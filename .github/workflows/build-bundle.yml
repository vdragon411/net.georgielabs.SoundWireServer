name: Build flatpak bundle

on:
#   push:
#     branches: [ master ]
#   pull_request:
#     branches: [ master ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: building flatpak bundle
        uses: nahuelwexd/flatpak-builder-action@kde-5.15
        with:
          manifest-path: net.georgielabs.SoundWireServer
          meson-args: -Dprofile=development
          flatpak-module: soundwireserver
          app-id: net.georgielabs.SoundWireServer
          bundle: net.georgielabs.SoundWireServer.flatpak
      - name: Release
        uses: softprops/action-gh-release@v1
        if: startsWith(github.ref, 'refs/tags/')
        with:
          files: net.georgielabs.SoundWireServer.flatpak
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
